<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Blockchain Testing Program</title>
    <style>
        pre {
            background: #E0F2F7;
        }
    </style>
</head>

<body translate="no">

    <h4>NIH MedRec Demo (NIH 身份註冊管理程式) </h4>

    <table style="height: 97px;">
        <tbody>
            <tr>
                <td><button id="addToRegistries">個人資料註冊</button></td>
                <td><input id="data1_id" type="text" placeholder="輸入身分證號" /></td>
                <td><input id="data1_name" type="text" placeholder="輸入個人姓名" /></td>
                <td><input id="data1_id_address" type="text" placeholder="輸入區塊鏈位址" /></td>
                <td>&nbsp;</td>
            </tr>

            <tr>
                <td><button id="checkRegistries">查詢個人資料</button></td>
                <td><input id="data2_id" type="text" placeholder="輸入身分證號" /></td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>

            <tr>
                <td><button id="updateAllToRegistries">修改個人資料</button></td>
                <td><input id="data3_id" type="text" placeholder="輸入身分證號" /></td>
                <td><input id="data3_name" type="text" placeholder="輸入個人姓名" /></td>
                <td><input id="data3_id_address" type="text" placeholder="輸入區塊鏈位址" /></td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td><button id="checkTxnLogBySeq">查詢交易記錄</button></td>
                <td><input id="data4_seq" type="text" placeholder="輸入流水號" /></td>
                <td><button id="checkTxnLogSize">查詢交易記錄大小</button></td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td><button id="getTransactionReceipt">查詢交易憑據</button></td>
                <td><input id="data5_txnHash" type="text" placeholder="輸入交易雜揍值" /></td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
        </tbody>
    </table>


    <h4>執行結果 : </h4>
    <pre id="log"></pre>

    <script src='web3.min.js'></script>
    <script src='jquery.min.js'></script>
    <script src='ethereumjs-tx.js'></script>

    <script>
        function log(input) {
            if (typeof input === 'object') {
                input = JSON.stringify(input, null, 2);
            }
            $('#log').html(input + '\n' + $('#log').html());
        }

        var web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'))
        var eth = web3.eth

        var RegistrarContractAbi = [{"constant":false,"inputs":[{"name":"id","type":"bytes32"},{"name":"id_address","type":"address"}],"name":"updateIdAddressToRegistries","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"bytes32"},{"name":"name","type":"bytes32"}],"name":"updateNameToRegistries","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"seq","type":"uint256"}],"name":"checkTxnLogBySeq","outputs":[{"name":"","type":"uint256"},{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkMsgSender","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkRegistriesSize","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"bytes32"}],"name":"removeFromRegistries","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"bytes32"},{"name":"sc_address","type":"address"}],"name":"updateSCAddressToRegistries","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"bytes32"},{"name":"name","type":"bytes32"},{"name":"id_address","type":"address"},{"name":"sc_address","type":"address"}],"name":"addToRegistries","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"id","type":"bytes32"}],"name":"checkRegistries","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkTxnLogSize","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"bytes32"},{"name":"name","type":"bytes32"},{"name":"id_address","type":"address"},{"name":"sc_address","type":"address"}],"name":"updateAllToRegistries","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"register_account","type":"address"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"bytes32"},{"indexed":false,"name":"name","type":"bytes32"},{"indexed":false,"name":"id_address","type":"address"},{"indexed":false,"name":"sc_adress","type":"address"}],"name":"EventForAddToRegistries","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"bytes32"}],"name":"EventForRemoveFromRegistries","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"bytes32"},{"indexed":false,"name":"name","type":"bytes32"},{"indexed":false,"name":"id_address","type":"address"},{"indexed":false,"name":"sc_adress","type":"address"}],"name":"EventForUpdateToRegistries","type":"event"}];

        var RegistrarContract = web3.eth.contract(RegistrarContractAbi);
        var RegistrarContractAddress = '0x492789b269c65bd0bd6539f9a59c2a84c631bbdb';
        var Registrar = RegistrarContract.at(RegistrarContractAddress);

        alert('Finish getting Registrar Instance');

		var nih_account = web3.eth.accounts[0];

        contractControl(Registrar, nih_account, eth)

        function contractControl(Registrar, nih_account, eth) {

            $('#checkRegistries').on('click', function() {

				var f_id   = $('#data2_id').val()
                var fields = Registrar.checkRegistries($('#data2_id').val())
                var f_name = fields[0]
                var f_id_address = fields[1]
                var f_sc_address = fields[2]

                var s_name = f_name.match(/.{1,2}/g).map(function(v) {
                    return String.fromCharCode(parseInt(v, 16));
                }).join('');
				
                log(' 資料查詢 { \n' +
                    ' 身分證號 : ' + f_id + '\n' +
                    ' 個人姓名 : ' + s_name + '\n' +
                    ' 區塊鏈位址 : ' + f_id_address + '\n' +
                    ' 授權合約位址 : ' + f_sc_address  + '\n}')

			})
			
            $('#addToRegistries').on('click', function() {

				var input_id   = $('#data1_id').val()
				var input_name = $('#data1_name').val()
				var input_id_address = $('#data1_id_address').val()
				//var input_sc_address = $('#data1_sc_address').val()
				var input_sc_address = "0x0000000000000000000000000000000000000000";
				
                var fields = Registrar.checkRegistries($('#data1_id').val())
                var f_name = fields[0]
                var f_id_address = fields[1]
                var f_sc_address = fields[2]

				if(f_id_address != "0x0000000000000000000000000000000000000000") {
                    alert("身分證號已被註冊")
                    return;
				}

				//alert(input_id_address + " " + web3.isAddress(input_id_address))
				//alert(input_sc_address + " " + web3.isAddress(input_sc_address))

                var txHashA = Registrar.addToRegistries(input_id, input_name, input_id_address, input_sc_address,{
                    from: nih_account,
                    gas: 600000
                }, function(err, txhash) {
                    if (!err) {
                        var theEvent = Registrar.EventForAddToRegistries({
                            from: nih_account
                        });
                        theEvent.watch(function(err, event) {
                            if (!err) {
                                alert('註冊成功，開始部署授權合約至區塊鏈。');
                                log(event);
                                theEvent.stopWatching();
								doSummaryContractDeploy(Registrar,input_id, input_id_address);
                            } else {
                                log(err);
                            }
                        });
                    } else {
                        log(err);
                    }
                });
				
            })

            $('#updateAllToRegistries').on('click', function() {

				var input_id   = $('#data3_id').val()
				var input_name = $('#data3_name').val()
				var input_id_address = $('#data3_id_address').val()
				//var input_sc_address = $('#data3_sc_address').val()
				
                var fields = Registrar.checkRegistries($('#data3_id').val())
                var f_name = fields[0]
                var f_id_address = fields[1]
                var f_sc_address = fields[2]

				if(f_id_address == "0x0000000000000000000000000000000000000000") {
                    alert("未註冊之身分證號")
                    return;
				}

                var txHashA = Registrar.updateAllToRegistries(input_id, input_name, input_id_address, f_sc_address,{
                    from: nih_account,
                    gas: 600000
                }, function(err, txhash) {
                    if (!err) {
                        var theEvent = Registrar.EventForUpdateToRegistries({
                            from: nih_account
                        });
                        theEvent.watch(function(err, event) {
                            if (!err) {
                                //log('交易序號' + event.args.id);
                                log(event);
                                theEvent.stopWatching();
                            } else {
                                log(err);
                            }
                        });
                    } else {
                        log(err);
                    }
                });
				
            })


            $('#getTransactionReceipt').on('click', function() {

                var dataA = eth.getTransactionReceipt($('#data5_txnHash').val())
                log(dataA)

                var dataA = eth.getTransaction($('#data5_txnHash').val())
                log(dataA)

				var key = web3.sha3("0x0000000000000000000000000000000000000000000000000000000000000001", {encoding:"hex"});
				var bn = web3.toBigNumber("0x" + key);
				var result = web3.eth.getStorageAt("0xa98ce9ac2a80978f33f6bda08497ddeb41686917", bn);
				log(result)

/*
				for(i=0;i<10;i++) {
					//var dataA = eth.getStorageAt("0xa98ce9ac2a80978f33f6bda08497ddeb41686917",i,4)
					var dataA = eth.getStorageAt("0xa98ce9ac2a80978f33f6bda08497ddeb41686917",i)
					log(dataA)
				}
*/				
			
				//var dataB = eth.getBlock($('#data5_txnHash').val())
				//log(dataB)
				
				//var dataC = eth.getTransactionCount(nih_account)
				//log(dataC)

				//alert(web3.eth.getBalance(eth.accounts[0]),"ether")
				//alert(web3.eth.getBalance(eth.accounts[1]),"ether")
				//alert(web3.eth.getBalance(eth.accounts[2]),"ether")

/*
				var txx = 'f8e6098504a817c80083015f9094e64d325f261d7ad178f4509f39ac7d6e7dfd19d980b880414141000000000000000000000000000000000000000000000000000000000041414141000000000000000000000000000000000000000000000000000000000000000000000000000000001f6a3a0b2afc6559845baf3d5a164ad4a61bdd090000000000000000000000007252b384520baf258f57e8e7ef1b495f51912f881ca07cb7b318d774a4641224ad38d2b4e377b372ceb7644dd308e0d567d31c881401a05da0fc8a809ab3e76a6586188c63abffde3d46f795375f7504c6363280a22acf'
		
				log(txx)

				var rt = web3.eth.getTransactionReceipt("0xf71e6b055cab18232525c7ffa1c41072033d5c9adbdc2f711cb9a913be1e7bd9");	  
				log(rt);
				
				//var tc  = web3.eth.getTransactionCount(eth.accounts[0])
				//log(tc);
				web3.eth.sendRawTransaction(txx, function(err, hash) {
				  if (!err)
					  alert(web3.eth.getBalance(eth.accounts[0]),"ether")
					  alert(web3.eth.getBalance(eth.accounts[1]),"ether")
					  alert(web3.eth.getBalance(eth.accounts[2]),"ether")
				      log(hash);
	  				  var tc  = web3.eth.getTransactionCount(eth.accounts[0])
	  				  log(tc);
				});
*/				
            })

           $('#checkTxnLogBySeq').on('click', function() {

                var fields = Registrar.checkTxnLogBySeq($('#data4_seq').val())
                var f_time = fields[0]
                var f_id = fields[1]
                var f_name = fields[2]
                var f_id_address = fields[3]
                var f_sc_address = fields[4]
                var f_note = fields[5]

                var d = new Date();
                var s_time = new Date(f_time * 1000 + d.getTimezoneOffset() * 60000)

                var s_id = f_id.match(/.{1,2}/g).map(function(v) {
                    return String.fromCharCode(parseInt(v, 16));
                }).join('');

                var s_name = f_name.match(/.{1,2}/g).map(function(v) {
                    return String.fromCharCode(parseInt(v, 16));
                }).join('');

                var s_note = f_note.match(/.{1,2}/g).map(function(v) {
                    return String.fromCharCode(parseInt(v, 16));
                }).join('');

                log(' 交易紀錄 : ' + $('#data4_seq').val() + ' { \n' +
                    ' 交易時間 : ' + s_time + '\n' +
                    ' 身分證號 : ' + s_id + '\n' +
                    ' 個人姓名 : ' + s_name + '\n' +
                    ' 區塊鏈位址 : ' + f_id_address + '\n' +
                    ' 授權合約位址 : ' + f_sc_address + '\n' +
                    ' 交易備註 : ' + s_note + '\n}')

            })

            $('#checkTxnLogSize').on('click', function() {

                var query_bank_name = $('#query_bank2').val();

                var dataA = Registrar.checkTxnLogSize()
                log(' 交易紀錄大小 : ' + dataA)

            })
			
		}

		function doSummaryContractDeploy(Registrar,input_id, input_id_address) {
			
	        $(function() {

	            var sAbi = [{"constant":true,"inputs":[{"name":"hospital_requester","type":"bytes32"},{"name":"hospital_provider","type":"bytes32"}],"name":"checkItemSize","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"seq","type":"uint256"}],"name":"checkTxnLogBySeq","outputs":[{"name":"","type":"uint256"},{"name":"","type":"bytes32[]"},{"name":"","type":"bytes32[]"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkMsgSender","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"addModifier","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"checkHospitalSize","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"hospital_requester","type":"bytes32"},{"name":"hospital_provider","type":"bytes32"},{"name":"item_id","type":"bytes32"}],"name":"getItem","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"bytes32[]"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"hospital_requester","type":"bytes32"},{"name":"hospital_provider","type":"bytes32"},{"name":"item_id","type":"bytes32"}],"name":"removeItemFromSummaries","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"canModify","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"modifierCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"removeModifier","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"hospital_requester","type":"bytes32"},{"name":"hospital_provider","type":"bytes32"},{"name":"item_id","type":"bytes32"},{"name":"item_name","type":"bytes32"},{"name":"purposes","type":"bytes32[]"},{"name":"provider_exp_time","type":"uint256"},{"name":"item_exp_time","type":"uint256"}],"name":"updateItemToSummaries","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"owner_address","type":"address"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"time","type":"uint256"},{"indexed":false,"name":"owner_id_address","type":"address"},{"indexed":false,"name":"hospital_requester","type":"bytes32"},{"indexed":false,"name":"hospital_provider","type":"bytes32"},{"indexed":false,"name":"item_id","type":"bytes32"},{"indexed":false,"name":"item_name","type":"bytes32"},{"indexed":false,"name":"purposes","type":"bytes32[]"},{"indexed":false,"name":"provider_exp_time","type":"uint256"},{"indexed":false,"name":"item_exp_time","type":"uint256"}],"name":"EventForUpdateToSummaries","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"time","type":"uint256"},{"indexed":false,"name":"owner_id_address","type":"address"},{"indexed":false,"name":"hospital_requester","type":"bytes32"},{"indexed":false,"name":"hospital_provider","type":"bytes32"},{"indexed":false,"name":"item_id","type":"bytes32"}],"name":"EventForRemoveFromSummaries","type":"event"}];

	            var sContract = web3.eth.contract(sAbi)

	            var s = sContract.new(
	                input_id_address,
	                {
	                    from: web3.eth.accounts[0],
	                    data: '0x6060604052341561000c57fe5b604051602080612763833981016040528080519060200190919050505b80600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600860008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055506007600081548092919060010191905055505b505b61267d806100e66000396000f300606060405236156100b8576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806311f2a8dc146100ba5780631256fa53146100ff578063443831de146101515780634cd3d5ca1461023f578063a013fe3014610291578063aaa10ba3146102c7578063b2622046146102ed578063b6a53780146103ab578063bcbcaac2146103e9578063c0193cc514610437578063eafb96bd1461045d578063ee2040c714610493575bfe5b34156100c257fe5b6100e960048080356000191690602001909190803560001916906020019091905050610530565b6040518082815260200191505060405180910390f35b341561010757fe5b61010f610579565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561015957fe5b61016f6004808035906020019091905050610582565b6040518086815260200180602001806020018581526020018481526020018381038352878181518152602001915080519060200190602002808383600083146101d7575b8051825260208311156101d7576020820191506020810190506020830392506101b3565b505050905001838103825286818151815260200191508051906020019060200280838360008314610227575b80518252602083111561022757602082019150602081019050602083039250610203565b50505090500197505050505050505060405180910390f35b341561024757fe5b61024f6107f3565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561029957fe5b6102c5600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506107fc565b005b34156102cf57fe5b6102d7610920565b6040518082815260200191505060405180910390f35b34156102f557fe5b610329600480803560001916906020019091908035600019169060200190919080356000191690602001909190505061092e565b60405180856000191660001916815260200180602001848152602001838152602001828103825285818151815260200191508051906020019060200280838360008314610395575b80518252602083111561039557602082019150602081019050602083039250610371565b5050509050019550505050505060405180910390f35b34156103b357fe5b6103e76004808035600019169060200190919080356000191690602001909190803560001916906020019091905050610b87565b005b34156103f157fe5b61041d600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061145a565b604051808215151515815260200191505060405180910390f35b341561043f57fe5b61044761147a565b6040518082815260200191505060405180910390f35b341561046557fe5b610491600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611480565b005b341561049b57fe5b61052e600480803560001916906020019091908035600019169060200190919080356000191690602001909190803560001916906020019091908035906020019082018035906020019080806020026020016040519081016040528093929190818152602001838360200280828437820191505050505050919080359060200190919080359060200190919050506115ac565b005b6000600060020160008460001916600019168152602001908152602001600020600301600083600019166000191681526020019081526020016000206000015490505b92915050565b60003090505b90565b600061058c61254b565b61059461254b565b6000600060006105a261254b565b600060006000600560010160008c815260200190815260200160002060000154945060056040518059106105d35750595b908082528060200260200182016040525b509350600560010160008c81526020019081526020016000206002015484600081518110151561061057fe5b906020019060200201906000191690816000191681525050600560010160008c81526020019081526020016000206003015484600181518110151561065157fe5b906020019060200201906000191690816000191681525050600560010160008c81526020019081526020016000206004015484600281518110151561069257fe5b906020019060200201906000191690816000191681525050600560010160008c8152602001908152602001600020600501548460038151811015156106d357fe5b906020019060200201906000191690816000191681525050600560010160008c81526020019081526020016000206009015484600481518110151561071457fe5b906020019060200201906000191690816000191681525050600560010160008c81526020019081526020016000206006019250600560010160008c8152602001908152602001600020600701549150600560010160008c81526020019081526020016000206008015490508484848484828054806020026020016040519081016040528092919081815260200182805480156107d357602002820191906000526020600020905b815460001916815260200190600101908083116107bb575b50505050509250995099509950995099505b505050505091939590929450565b60003390505b90565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561091657600860008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161515610910576001600860008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055506007600081548092919060010191905055505b5b61091c565b60006000fd5b5b50565b600060006000015490505b90565b600061093861254b565b60006000600061094661254b565b600060006000601460405180591061095b5750595b908082528060200260200182016040525b509350600060020160008d6000191660001916815260200190815260200160002060030160008c60001916600019168152602001908152602001600020600501549250600060020160008d6000191660001916815260200190815260200160002060030160008c6000191660001916815260200190815260200160002060030160008b60001916600019168152602001908152602001600020600301549150429050828110158015610a1f575060008314155b15610a3557848484849850985098509850610b79565b818110158015610a46575060008214155b15610a5c57848484849850985098509850610b79565b600060020160008d6000191660001916815260200190815260200160002060030160008c6000191660001916815260200190815260200160002060030160008b60001916600019168152602001908152602001600020600101549450600060020160008d6000191660001916815260200190815260200160002060030160008c6000191660001916815260200190815260200160002060030160008b60001916600019168152602001908152602001600020600201805480602002602001604051908101604052809291908181526020018280548015610b5f57602002820191906000526020600020905b81546000191681526020019060010190808311610b47575b50505050509350848484849850985098509850610b79565b5b5b505050505093509350935093565b6000600060006000600060006000600860003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16156114475760006000600001541415610bfb5760006000fd5b600060020160008b6000191660001916815260200190815260200160002060030160008a6000191660001916815260200190815260200160002060030160008960001916600019168152602001908152602001600020600101549650600060020160008b6000191660001916815260200190815260200160002060030160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206002019550600060020160008b6000191660001916815260200190815260200160002060030160008a6000191660001916815260200190815260200160002060030160008960001916600019168152602001908152602001600020600301549450600060020160008b6000191660001916815260200190815260200160002060030160008a60001916600019168152602001908152602001600020600501549350600060020160008b6000191660001916815260200190815260200160002060030160008a600019166000191681526020019081526020016000206004016000896000191660001916815260200190815260200160002060009054906101000a900460ff161561117157600060020160008b6000191660001916815260200190815260200160002060030160008a60001916600019168152602001908152602001600020600201805490509250600091505b82821015610f41578760001916600060020160008c6000191660001916815260200190815260200160002060030160008b6000191660001916815260200190815260200160002060020183815481101515610e5657fe5b906000526020600020900160005b5054600019161415610f3357600060020160008b6000191660001916815260200190815260200160002060030160008a6000191660001916815260200190815260200160002060020160018403815481101515610ebd57fe5b906000526020600020900160005b5054600060020160008c6000191660001916815260200190815260200160002060030160008b6000191660001916815260200190815260200160002060020183815481101515610f1757fe5b906000526020600020900160005b508160001916905550610f41565b5b8180600101925050610dff565b600060020160008b6000191660001916815260200190815260200160002060030160008a600019166000191681526020019081526020016000206002016001600060020160008d6000191660001916815260200190815260200160002060030160008c600019166000191681526020019081526020016000206000015403815481101515610fcb57fe5b906000526020600020900160005b5060009055600060020160008b6000191660001916815260200190815260200160002060030160008a6000191660001916815260200190815260200160002060020180548091906001900361102e919061255f565b50600060020160008b6000191660001916815260200190815260200160002060030160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206000600082016000905560018201600090556002820160006110a7919061258b565b600382016000905550506000600060020160008c6000191660001916815260200190815260200160002060030160008b6000191660001916815260200190815260200160002060040160008a6000191660001916815260200190815260200160002060006101000a81548160ff0219169083151502179055506001600060020160008c6000191660001916815260200190815260200160002060030160008b6000191660001916815260200190815260200160002060000160008282540392505081905550611177565b60006000fd5b42905060016005600001540160056000018190555061014060405190810160405280828152602001600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018b6000191681526020018a60001916815260200189600019168152602001886000191681526020018780548060200260200160405190810160405280929190818152602001828054801561125457602002820191906000526020600020905b8154600019168152602001906001019080831161123c575b505050505081526020018581526020018681526020017f52454d4f56450000000000000000000000000000000000000000000000000000600019168152506005600101600060056000015481526020019081526020016000206000820151816000015560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160020190600019169055606082015181600301906000191690556080820151816004019060001916905560a0820151816005019060001916905560c082015181600601908051906020019061135a9291906125ad565b5060e08201518160070155610100820151816008015561012082015181600901906000191690559050507f1041782bf1263b91c8e24f3df5d661977f41f2bfa73c4c034f31ff0c573ce52d81600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168c8c8c604051808681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018460001916600019168152602001836000191660001916815260200182600019166000191681526020019550505050505060405180910390a15b61144d565b60006000fd5b5b50505050505050505050565b60086020528060005260406000206000915054906101000a900460ff1681565b60075481565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156115a257600160075414156114e75760006000fd5b600860008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161561159c57600860008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81549060ff0219169055600760008154809291906001900391905055505b5b6115a8565b60006000fd5b5b50565b6000600860003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161561253a5760006003016000896000191660001916815260200190815260200160002060009054906101000a900460ff161515611a2957600060010180548060010182816116499190612600565b916000526020600020900160005b8a909190915090600019169055506001600060030160008a6000191660001916815260200190815260200160002060006101000a81548160ff02191690831515021790555087600060020160008a60001916600019168152602001908152602001600020600101816000191690555060006002016000896000191660001916815260200190815260200160002060020180548060010182816116f99190612600565b916000526020600020900160005b89909190915090600019169055506001600060020160008a600019166000191681526020019081526020016000206004016000896000191660001916815260200190815260200160002060006101000a81548160ff0219169083151502179055506001600060020160008a600019166000191681526020019081526020016000206000016000828254019250508190555086600060020160008a6000191660001916815260200190815260200160002060030160008960001916600019168152602001908152602001600020600101816000191690555082600060020160008a6000191660001916815260200190815260200160002060030160008960001916600019168152602001908152602001600020600501819055506001600060020160008a6000191660001916815260200190815260200160002060030160008960001916600019168152602001908152602001600020600001600082825401925050819055506000600201600089600019166000191681526020019081526020016000206003016000886000191660001916815260200190815260200160002060020180548060010182816118bb9190612600565b916000526020600020900160005b88909190915090600019169055506001600060020160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206004016000886000191660001916815260200190815260200160002060006101000a81548160ff021916908315150217905550608060405190810160405280876000191681526020018660001916815260200185815260200183815250600060020160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206003016000886000191660001916815260200190815260200160002060008201518160000190600019169055602082015181600101906000191690556040820151816002019080519060200190611a029291906125ad565b50606082015181600301559050506001600060000160008282540192505081905550612246565b6000600201600089600019166000191681526020019081526020016000206004016000886000191660001916815260200190815260200160002060009054906101000a900460ff161515611daa576000600201600089600019166000191681526020019081526020016000206002018054806001018281611aaa9190612600565b916000526020600020900160005b89909190915090600019169055506001600060020160008a600019166000191681526020019081526020016000206004016000896000191660001916815260200190815260200160002060006101000a81548160ff0219169083151502179055506001600060020160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206000016000828254019250508190555086600060020160008a6000191660001916815260200190815260200160002060030160008960001916600019168152602001908152602001600020600101816000191690555082600060020160008a600019166000191681526020019081526020016000206003016000896000191660001916815260200190815260200160002060050181905550600060020160008960001916600019168152602001908152602001600020600301600088600019166000191681526020019081526020016000206002018054806001018281611c3c9190612600565b916000526020600020900160005b88909190915090600019169055506001600060020160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206004016000886000191660001916815260200190815260200160002060006101000a81548160ff021916908315150217905550608060405190810160405280876000191681526020018660001916815260200185815260200183815250600060020160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206003016000886000191660001916815260200190815260200160002060008201518160000190600019169055602082015181600101906000191690556040820151816002019080519060200190611d839291906125ad565b50606082015181600301559050506001600060000160008282540192505081905550612245565b600060020160008960001916600019168152602001908152602001600020600301600088600019166000191681526020019081526020016000206004016000876000191660001916815260200190815260200160002060009054906101000a900460ff16151561204b57600060020160008960001916600019168152602001908152602001600020600301600088600019166000191681526020019081526020016000206002018054806001018281611e639190612600565b916000526020600020900160005b889091909150906000191690555082600060020160008a6000191660001916815260200190815260200160002060030160008960001916600019168152602001908152602001600020600501819055506001600060020160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206004016000886000191660001916815260200190815260200160002060006101000a81548160ff021916908315150217905550608060405190810160405280876000191681526020018660001916815260200185815260200183815250600060020160008a60001916600019168152602001908152602001600020600301600089600019166000191681526020019081526020016000206003016000886000191660001916815260200190815260200160002060008201518160000190600019169055602082015181600101906000191690556040820151816002019080519060200190611fec9291906125ad565b50606082015181600301559050506001600060020160008a600019166000191681526020019081526020016000206003016000896000191660001916815260200190815260200160002060000160008282540192505081905550612244565b600060020160008960001916600019168152602001908152602001600020600301600088600019166000191681526020019081526020016000206004016000876000191660001916815260200190815260200160002060009054906101000a900460ff16156122435782600060020160008a600019166000191681526020019081526020016000206003016000896000191660001916815260200190815260200160002060050181905550600060020160008960001916600019168152602001908152602001600020600301600088600019166000191681526020019081526020016000206003016000876000191660001916815260200190815260200160002060006000820160009055600182016000905560028201600061216e919061258b565b60038201600090555050608060405190810160405280876000191681526020018660001916815260200185815260200183815250600060020160008a600019166000191681526020019081526020016000206003016000896000191660001916815260200190815260200160002060030160008860001916600019168152602001908152602001600020600082015181600001906000191690556020820151816001019060001916905560408201518160020190805190602001906122349291906125ad565b50606082015181600301559050505b5b5b5b42905060016005600001540160056000018190555061014060405190810160405280828152602001600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001896000191681526020018860001916815260200187600019168152602001866000191681526020018581526020018481526020018381526020017f5550444154450000000000000000000000000000000000000000000000000000600019168152506005600101600060056000015481526020019081526020016000206000820151816000015560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160020190600019169055606082015181600301906000191690556080820151816004019060001916905560a0820151816005019060001916905560c08201518160060190805190602001906123d69291906125ad565b5060e08201518160070155610100820151816008015561012082015181600901906000191690559050507f79fd393c82bc89977b69a5d4d24370b01f021e677eedd8953c2f3e918b99a9a581600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168a8a8a8a8a8a8a604051808a81526020018973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200188600019166000191681526020018760001916600019168152602001866000191660001916815260200185600019166000191681526020018060200184815260200183815260200182810382528581815181526020019150805190602001906020028083836000831461251a575b80518252602083111561251a576020820191506020810190506020830392506124f6565b5050509050019a505050505050505050505060405180910390a15b612540565b60006000fd5b5b5050505050505050565b602060405190810160405280600081525090565b81548183558181151161258657818360005260206000209182019101612585919061262c565b5b505050565b50805460008255906000526020600020908101906125a9919061262c565b5b50565b8280548282559060005260206000209081019282156125ef579160200282015b828111156125ee5782518290600019169055916020019190600101906125cd565b5b5090506125fc919061262c565b5090565b81548183558181151161262757818360005260206000209182019101612626919061262c565b5b505050565b61264e91905b8082111561264a576000816000905550600101612632565b5090565b905600a165627a7a72305820ebf9e6598fb6fd743efd992d83cbb348f9e6400c2f30ad47a3eb1b4787bd2e6e0029',
	                    gas: 4700000
	                },
	                function(e, contract) {

	                    if (typeof contract.address !== 'undefined') {
	                        log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash)
							alert("授權合約部署成功，位址: "+contract.address+"，開始更新個人資訊")
							
			                var txHashB = Registrar.updateSCAddressToRegistries(input_id, contract.address,{
			                    from: web3.eth.accounts[0],
			                    gas: 600000
			                }, function(err, txhash) {
			                    if (!err) {
			                        var theEvent = Registrar.EventForUpdateToRegistries({
			                            from: web3.eth.accounts[0]
			                        });
			                        theEvent.watch(function(err, event) {
			                            if (!err) {
			                                alert("更新個人資訊完成");
			                                theEvent.stopWatching();
			                            } else {
			                                log(err);
			                            }
			                        });
			                    } else {
			                        log(err);
			                    }
			                });
				
	                    }
	                })

	        })
			
			
		}
		
    </script>
</body>

</html>